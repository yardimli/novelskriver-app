<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- MODIFIED: Added img-src 'data:' to the CSP meta tag for consistency, though the header from electron-main.js takes precedence. This change is for correctness if the file were used in a different context. -->
	<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;">
	<title>Create a New Novel</title>
	<!-- NEW: Added Bootstrap Icons stylesheet -->
	<link rel="stylesheet" href="../node_modules/bootstrap-icons/font/bootstrap-icons.css">
	<link rel="stylesheet" href="../dist/styles.css">
</head>
<body>
<div class="container mx-auto p-8 max-w-3xl">
	<div class="text-center mb-8">
		<h1 class="text-4xl font-bold">Create a new Novel</h1>
		<p class="text-lg text-base-content/70">Let's get your next masterpiece started.</p>
	</div>
	
	<form id="createNovelForm" class="card bg-base-200 shadow-xl">
		<div class="card-body space-y-4">
			<!-- Title -->
			<div class="form-control">
				<label for="title" class="label"><span class="label-text">Title</span></label>
				<div class="join w-full">
					<input type="text" id="title" name="title" class="input input-bordered grow rounded-r-none" required>
					<!-- MODIFIED: Button content is wrapped in spans to allow toggling with a spinner. -->
					<button type="button" id="surprise-me-btn" class="btn btn-neutral rounded-l-none gap-2">
						<span class="js-btn-content flex items-center gap-2">
							<i class="bi bi-magic"></i>
							<span>Surprise me</span>
						</span>
						<span class="js-btn-spinner animate-spin hidden">
							<i class="bi bi-arrow-repeat"></i>
						</span>
					</button>
				</div>
			</div>
			
			<!-- Author -->
			<div class="form-control">
				<label for="author" class="label"><span class="label-text">Author / Pen name</span></label>
				<div class="join w-full">
					<!-- MODIFIED: Removed right border radius to join with button. -->
					<input type="text" id="author" name="author" class="input input-bordered grow rounded-r-none" required>
					<div class="dropdown dropdown-end">
						<!-- MODIFIED: Added background color and removed left border radius to join with input. -->
						<button type="button" id="author-dropdown-btn" tabindex="0" role="button" class="btn btn-neutral rounded-l-none">
							Select
							<i class="bi bi-chevron-down ml-1"></i>
						</button>
						<ul id="author-list" tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
							<!-- Author list populated by JS -->
						</ul>
					</div>
				</div>
			</div>
			
			<!-- Series -->
			<div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
				<div class="md:col-span-2 form-control">
					<label for="series_id" class="label"><span class="label-text">Series (optional)</span></label>
					<div class="join w-full">
						<!-- MODIFIED: Removed right border radius to join with button. -->
						<select id="series_id" name="series_id" class="select select-bordered grow rounded-r-none">
							<option value="">â€”</option>
							<!-- Series options loaded by JS -->
						</select>
						<!-- MODIFIED: Added background color and removed left border radius to join with input. -->
						<button type="button" id="new-series-btn" class="btn btn-neutral rounded-l-none gap-2">
							<i class="bi bi-plus-lg"></i>
							New Series
						</button>
					</div>
				</div>
				<div class="form-control">
					<label for="series_index" class="label"><span class="label-text">Series index</span></label>
					<input type="number" id="series_index" name="series_index" class="input input-bordered w-full" placeholder="Book #">
				</div>
			</div>
			
			<div class="card-actions justify-between pt-6">
				<a href="index.html" class="btn btn-ghost">Back</a>
				<!-- MODIFIED: Button content is wrapped in spans to allow toggling with a spinner. -->
				<button type="submit" id="create-novel-submit-btn" class="btn btn-primary w-36">
					<span class="js-btn-content">Create Novel</span>
					<span class="js-btn-spinner animate-spin hidden">
						<i class="bi bi-arrow-repeat"></i>
					</span>
				</button>
			</div>
		</div>
	</form>
</div>

<!-- MODIFIED: Refactored modal using DaisyUI classes -->
<dialog id="new-series-modal" class="modal">
	<div class="modal-box">
		<h3 class="font-bold text-lg">Create a New Series</h3>
		<div class="py-4">
			<label for="new_series_title" class="label"><span class="label-text">Series Title</span></label>
			<input type="text" id="new_series_title" class="input input-bordered w-full" required>
			<p id="new-series-error" class="text-error text-xs mt-1 hidden"></p>
		</div>
		<div class="modal-action">
			<form method="dialog" class="flex gap-3">
				<button class="btn js-close-modal">Cancel</button>
				<!-- MODIFIED: Button content is wrapped in spans to allow toggling with a spinner. -->
				<button type="button" id="save-new-series-btn" class="btn btn-primary w-28">
					<span class="js-btn-content">Save Series</span>
					<span class="js-btn-spinner animate-spin hidden">
						<i class="bi bi-arrow-repeat"></i>
					</span>
				</button>
			</form>
		</div>
	</div>
	<form method="dialog" class="modal-backdrop"><button>close</button></form>
</dialog>

<!-- NEW: Added universal theme script -->
<script src="../src/js/theme.js"></script>
<script src="../src/js/create-novel.js"></script>
</body>
</html>
